{
  "name": "LLM IoT",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "Ol√°! üëã\nEu sou o FIoT. Como posso ajud√°-lo?",
        "options": {
          "subtitle": "IoT + ML + n8n + LLM",
          "title": "Ol√°!"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -448,
        -64
      ],
      "id": "c3614d83-4c19-42f3-826a-01546e6208b8",
      "name": "When chat message received",
      "webhookId": "cd69ff2d-1f0f-4942-ae59-9fc4e593751e"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=Voc√™ √© um assistente de qualidade do ar. \n\nCONTEXTO TEMPORAL IMPORTANTE:\n- Data atual: {{ $now.format('yyyy-MM-DD') }}\n- Hora atual: {{ $now.format('HH:mm') }}\n- Dia da semana: {{ $now.format('EEEE') }}\n\nPER√çODOS DO DIA:\n- madrugada: 00:00 √†s 05:59\n- manh√£: 06:00 √†s 11:59\n- tarde: 12:00 √†s 17:59\n- noite: 18:00 √†s 23:59\n\nQuando o usu√°rio perguntar sobre qualidade do ar em um per√≠odo espec√≠fico (ex: \"nesta madrugada\", \"hoje de manh√£\"), use a ferramenta aqi_historico com os par√¢metros no formato: \"AAAA-MM-DD, periodo\"\n\nExemplos:\n- \"Como estava nesta madrugada?\" ‚Üí \"{{ $now.format('yyyy-MM-DD') }}, madrugada\"\n- \"Como estava ontem √† noite?\" ‚Üí \"{{ $now.minus({days: 1}).format('yyyy-MM-DD') }}, noite\"\n\nPara perguntas sobre \"agora\" ou \"atualmente\", use a ferramenta aqi_atual.\n\nLIMITA√á√ïES\n- N√£o invente valores de AQI. Sempre baseie sua resposta somente nos dados retornados pelas ferramentas.\n\nCONTEXTO DO LOCAL\n- A medi√ß√£o de qualidade do ar √© em uma f√°brica. Portanto, em medi√ß√µes perigosas, informe que n√£o se deve permanecer dentro da f√°brica.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -96,
        -64
      ],
      "id": "ff8aa4b7-a0e1-463f-b511-e2ef75b5923b",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": "llama3.2:latest",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOllama",
      "typeVersion": 1,
      "position": [
        -240,
        128
      ],
      "id": "80335d9a-222b-4fa5-82ab-b7277e4021c4",
      "name": "Ollama Chat Model",
      "credentials": {
        "ollamaApi": {
          "id": "NrojdgDH4WRP2HxM",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Essa ferramenta se chama: \"aqi_atual\" e responde como est√° a qualidade do ar agora, nesse instante. Tool ou ferramenta para informar a qualidade do ar mais recentemente observada.",
        "operation": "executeQuery",
        "query": "SELECT class, timestamp_medicao, periodo\nFROM aqi_medicoes\nORDER BY created_at DESC\nLIMIT 1;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        128,
        160
      ],
      "id": "a10de43f-6f0f-4c42-b935-3ca56843fe20",
      "name": "aqi_atual",
      "credentials": {
        "postgres": {
          "id": "206W8viNhQB2K0QF",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -32,
        144
      ],
      "id": "89ea8f06-67b7-4b3e-94de-364e3f954f47",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Esta ferramenta consulta dados hist√≥ricos de qualidade do ar. Sempre que voc√™ us√°-la, envie Query_Parameters como uma string no formato: \"AAAA-MM-DD, periodo\", por exemplo: \"2025-11-19, madrugada\".\nO campo periodo deve ser uma destas palavras exatas: madrugada, manh√£, tarde, noite.\n\n**N√ÉO USE ESSA FERRAMENTA OU TOOL PARA RESPONDER √Ä PERGUNTAS DE COMO A QUALIDADE DO AR EST√Å AGORA, OU QUAL A QUALIDADE DO AR MAIS RECENTE**",
        "operation": "executeQuery",
        "query": "SELECT class,\n       timestamp_medicao,\n       periodo\nFROM aqi_medicoes\nWHERE DATE(timestamp_medicao::timestamp) = $1\n  AND periodo = $2\nORDER BY created_at DESC\nLIMIT 1;\n",
        "options": {
          "queryReplacement": "={{ $fromAI('Query_Parameters', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        320,
        128
      ],
      "id": "d50f8db4-298f-4a06-a2d8-ad2ddc84477a",
      "name": "aqi_historico",
      "credentials": {
        "postgres": {
          "id": "206W8viNhQB2K0QF",
          "name": "Postgres account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "aqi_atual": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "aqi_historico": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cdb45e56-62cd-4b80-9b4f-26016c4a938a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0f95231834db7705ff3204de524e5fb047e626c5b2802b5e1565382eaf984fbc"
  },
  "id": "WHs2KVqzUSOLy1N8",
  "tags": []
}