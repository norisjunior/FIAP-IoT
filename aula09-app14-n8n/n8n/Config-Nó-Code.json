//RunOnceForEachItem

// 1) Usa o campo message (pode vir string JSON ou objeto)
const msg = $json.message;

// 2) Armazena na variável data e o timestamp correto
const data = JSON.parse(msg);

// --> timestamp local de São Paulo (simples)
const tsSp = new Date().toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo' });

// 3) Monta um objeto “limpo” só com as variáveis que queremos\n
return {
    json: {
        temp: data.temp,
        umid: data.umid,
        ic:   data.ic,
        dist: data.dist,
        mov:  data.mov,
        timestamp: tsSp,
        topic: $json.topic  // preserva o tópico (útil em logs/mensagens)
    }
};
